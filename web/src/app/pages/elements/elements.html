<div class="flex h-full flex-col ">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header -->
  <div class="flex justify-between items-center ">
    <h1 class="text-lg font-medium">Gestión de Elementos</h1>
    <p-button type="button" label="Crear" icon="pi pi-plus" (click)="showCreateModal()"></p-button>
  </div>

  <app-element-create-modal [visible]="isCreateModalVisible()" (onHide)="hideCreateModal()"></app-element-create-modal>
  <app-element-update-modal [visible]="isUpdateModalVisible()" [element]="selectedElement()!" (onHide)="hideUpdateModal()"></app-element-update-modal>

  <!-- Tabla -->
  <div class="flex-1 min-h-0 ">
    <div class="card flex-1 h-full overflow-hidden">
      <p-table #dt1
               [value]="elements()"
               dataKey="publicId"
               [rows]="10"
               [rowsPerPageOptions]="[10, 25, 50]"
               [loading]="loading()"
               [paginator]="true"
               [lazy]="true"
               (onLazyLoad)="loadElements($event)"
               [totalRecords]="totalRecords()"
               [first]="0"
               showGridlines
               [scrollable]="true"
               scrollHeight="flex">

        <ng-template pTemplate="caption">
          <div class="flex p-0 justify-between gap-4">
            <p-select 
              [options]="containerStore.containers()" 
              optionLabel="displayName" 
              optionValue="publicId"
              placeholder="Filtrar por contenedor"
              [showClear]="true"
              (onChange)="onContainerFilterChange($event.value)"
              class="w-64">
            </p-select>
            <p-inputgroup class="max-w-sm">
                <p-inputgroup-addon>
                    <i class="pi pi-search"></i>
                </p-inputgroup-addon>
                <input pInputText type="text" [value]="store.filters().query" (input)="onSearch($event)" placeholder="Buscar por nombre" class="text-sm"/>
                <p-inputgroup-addon>
                    <p-button icon="pi pi-times" severity="secondary" (click)="store.clearSearch()"></p-button>
                </p-inputgroup-addon>
            </p-inputgroup>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th style="min-width:10rem" pSortableColumn="name" class="text-sm">Nombre <p-sortIcon field="name"></p-sortIcon></th>
            <th style="min-width:15rem" pSortableColumn="displayName" class="text-sm">Nombre para Mostrar <p-sortIcon field="displayName"></p-sortIcon></th>
            <th style="min-width:10rem" class="text-sm">Icono</th>
            <th style="min-width:12rem" class="text-sm">Ruta</th>
            <th style="min-width:10rem" class="text-sm">Contenedor</th>
            <th style="min-width:8rem" pSortableColumn="orderIndex" class="text-sm">Orden <p-sortIcon field="orderIndex"></p-sortIcon></th>
            <th style="min-width:15rem" pSortableColumn="createdAt" class="text-sm">Fecha de Creación <p-sortIcon field="createdAt"></p-sortIcon></th>
            <th style="width: 8rem" class="text-sm">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-element>
          <tr>
            <td class="text-sm px-3">{{ element.name }}</td>
            <td class="text-sm px-3">{{ element.displayName }}</td>
            <td class="text-sm px-3">
              @if (element.iconUrl) {
                <img [src]="element.iconUrl" [alt]="element.displayName" class="w-6 h-6 object-contain" />
              } @else if (element.icon) {
                <i [class]="element.icon"></i>
              } @else {
                <span class="text-gray-400">-</span>
              }
            </td>
            <td class="text-sm px-3">{{ element.route || '-' }}</td>
            <td class="text-sm px-3">{{ element.container?.displayName || '-' }}</td>
            <td class="text-sm px-3">{{ element.orderIndex }}</td>
            <td class="text-sm px-3">
              <app-date-display
                [date]="element.createdAt"
                type="created"
                variant="table"
                size="sm">
              </app-date-display>
            </td>
            <td>
              <div class="flex justify-center gap-2">
                <button pButton type="button" icon="pi pi-pencil" class="p-button-warning h-8 w-8" (click)="showUpdateModal(element)"></button>
                <button pButton type="button" icon="pi pi-trash" class="p-button-danger h-8 w-8" (click)="confirmDelete(element)"></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr class="">
            <td colspan="8" class="text-center text-sm p-4">No se encontraron elementos.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

