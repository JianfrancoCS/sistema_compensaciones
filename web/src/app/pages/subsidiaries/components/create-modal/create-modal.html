<app-modal-template
  [visible]="visible"
  headerText="Crear Fundo"
  (onHide)="hideModal()"
  (onSubmit)="createSubsidiary()"
  [isSubmitDisabled]="subsidiaryForm.invalid"
>
  <form [formGroup]="subsidiaryForm">
    <div class="flex flex-col gap-4 mb-4">
      <label for="name" class="font-semibold text-sm">Nombre</label>
      <input pInputText id="name" formControlName="name" class="flex-auto text-sm" autocomplete="off" placeholder="Ej: Fundo San Juan" [invalid]="subsidiaryForm.get('name')?.invalid && (subsidiaryForm.get('name')?.dirty || subsidiaryForm.get('name')?.touched)" />
      @if (subsidiaryForm.get('name')?.invalid && (subsidiaryForm.get('name')?.dirty || subsidiaryForm.get('name')?.touched)) {
        @if (subsidiaryForm.get('name')?.errors?.['required']) {
          <p-message severity="error" variant="simple" size="small">El nombre es requerido.</p-message>
        }
        @if (subsidiaryForm.get('name')?.errors?.['pattern']) {
          <p-message severity="error" variant="simple" size="small">El nombre solo debe contener letras y espacios.</p-message>
        }
      }
    </div>

    <div class="flex flex-col gap-4 mb-4">
      <label for="department" class="font-semibold text-sm">Departamento</label>
      <p-select id="department" formControlName="departmentPublicId" [options]="departments()" optionLabel="name" optionValue="publicId" placeholder="Seleccione un departamento" styleClass="w-full" appendTo="body" (onChange)="onDepartmentChange($event)" [invalid]="subsidiaryForm.get('departmentPublicId')?.invalid && subsidiaryForm.get('departmentPublicId')?.touched"></p-select>
      @if (subsidiaryForm.get('departmentPublicId')?.invalid && subsidiaryForm.get('departmentPublicId')?.touched) {
        <p-message severity="error" variant="simple" size="small">El departamento es requerido.</p-message>
      }
    </div>

    <div class="flex flex-col gap-4 mb-4">
      <label for="province" class="font-semibold text-sm">Provincia</label>
      <p-select id="province" formControlName="provincePublicId" [options]="provinces()" optionLabel="name" optionValue="publicId" placeholder="Seleccione una provincia" [disabled]="!subsidiaryForm.get('departmentPublicId')?.value" styleClass="w-full" appendTo="body" (onChange)="onProvinceChange($event)" [invalid]="subsidiaryForm.get('provincePublicId')?.invalid && subsidiaryForm.get('provincePublicId')?.touched"></p-select>
      @if (subsidiaryForm.get('provincePublicId')?.invalid && subsidiaryForm.get('provincePublicId')?.touched) {
        <p-message severity="error" variant="simple" size="small">La provincia es requerida.</p-message>
      }
    </div>

    <div class="flex flex-col gap-4 mb-4">
      <label for="district" class="font-semibold text-sm">Distrito</label>
      <p-select id="district" formControlName="districtPublicId" [options]="districts()" optionLabel="name" optionValue="publicId" placeholder="Seleccione un distrito" [disabled]="!subsidiaryForm.get('provincePublicId')?.value" styleClass="w-full" appendTo="body" [invalid]="subsidiaryForm.get('districtPublicId')?.invalid && subsidiaryForm.get('districtPublicId')?.touched"></p-select>
      @if (subsidiaryForm.get('districtPublicId')?.invalid && subsidiaryForm.get('districtPublicId')?.touched) {
        <p-message severity="error" variant="simple" size="small">El distrito es requerido.</p-message>
      }
    </div>
  </form>
</app-modal-template>
