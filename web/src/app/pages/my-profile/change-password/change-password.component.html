<div class="p-6 max-w-2xl mx-auto">
  <p-toast></p-toast>

  <div class="mb-6">
    <button
      pButton
      type="button"
      icon="pi pi-arrow-left"
      label="Volver"
      class="p-button-text mb-4"
      (click)="goBack()">
    </button>
    <h1 class="text-3xl font-bold text-gray-800">Cambiar Contraseña</h1>
    <p class="text-gray-600 mt-2">Actualiza tu contraseña para mantener tu cuenta segura</p>
  </div>

  <p-card>
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="flex flex-col gap-4 mb-4">
        <label for="currentPassword" class="font-semibold text-sm">Contraseña Actual</label>
        <p-password
          id="currentPassword"
          formControlName="currentPassword"
          [feedback]="false"
          [toggleMask]="true"
          styleClass="w-full"
          inputStyleClass="w-full text-sm"
          placeholder="Ingresa tu contraseña actual"
          [invalid]="passwordForm.get('currentPassword')?.invalid && (passwordForm.get('currentPassword')?.dirty || passwordForm.get('currentPassword')?.touched)">
        </p-password>
        @if (passwordForm.get('currentPassword')?.invalid && (passwordForm.get('currentPassword')?.dirty || passwordForm.get('currentPassword')?.touched)) {
          @if (passwordForm.get('currentPassword')?.errors?.['required']) {
            <p-message severity="error" variant="simple" size="small">La contraseña actual es requerida.</p-message>
          }
        }
      </div>

      <div class="flex flex-col gap-4 mb-4">
        <label for="newPassword" class="font-semibold text-sm">Nueva Contraseña</label>
        <p-password
          id="newPassword"
          formControlName="newPassword"
          [feedback]="true"
          [toggleMask]="true"
          styleClass="w-full"
          inputStyleClass="w-full text-sm"
          placeholder="Ingresa tu nueva contraseña"
          [invalid]="passwordForm.get('newPassword')?.invalid && (passwordForm.get('newPassword')?.dirty || passwordForm.get('newPassword')?.touched)">
        </p-password>
        @if (passwordForm.get('newPassword')?.invalid && (passwordForm.get('newPassword')?.dirty || passwordForm.get('newPassword')?.touched)) {
          @if (passwordForm.get('newPassword')?.errors?.['required']) {
            <p-message severity="error" variant="simple" size="small">La nueva contraseña es requerida.</p-message>
          }
          @if (passwordForm.get('newPassword')?.errors?.['minlength']) {
            <p-message severity="error" variant="simple" size="small">La contraseña debe tener al menos 6 caracteres.</p-message>
          }
        }
      </div>

      <div class="flex flex-col gap-4 mb-4">
        <label for="confirmPassword" class="font-semibold text-sm">Confirmar Nueva Contraseña</label>
        <p-password
          id="confirmPassword"
          formControlName="confirmPassword"
          [feedback]="false"
          [toggleMask]="true"
          styleClass="w-full"
          inputStyleClass="w-full text-sm"
          placeholder="Confirma tu nueva contraseña"
          [invalid]="passwordForm.get('confirmPassword')?.invalid && (passwordForm.get('confirmPassword')?.dirty || passwordForm.get('confirmPassword')?.touched)">
        </p-password>
        @if (passwordForm.get('confirmPassword')?.invalid && (passwordForm.get('confirmPassword')?.dirty || passwordForm.get('confirmPassword')?.touched)) {
          @if (passwordForm.get('confirmPassword')?.errors?.['required']) {
            <p-message severity="error" variant="simple" size="small">La confirmación de contraseña es requerida.</p-message>
          }
          @if (passwordForm.get('confirmPassword')?.errors?.['passwordMismatch']) {
            <p-message severity="error" variant="simple" size="small">Las contraseñas no coinciden.</p-message>
          }
        }
      </div>

      <div class="flex gap-3 pt-4">
        <p-button
          type="button"
          label="Cancelar"
          icon="pi pi-times"
          severity="secondary"
          [outlined]="true"
          (click)="goBack()"
          [disabled]="changingPassword()"
          styleClass="flex-1">
        </p-button>
        <p-button
          type="submit"
          label="Cambiar Contraseña"
          icon="pi pi-key"
          [loading]="changingPassword()"
          [disabled]="passwordForm.invalid || changingPassword()"
          styleClass="flex-1">
        </p-button>
      </div>
    </form>
  </p-card>
</div>

