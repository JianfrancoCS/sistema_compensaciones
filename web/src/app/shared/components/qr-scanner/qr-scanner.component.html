<div class="qr-scanner-wrapper">
  <p-toast></p-toast>

  <!-- Scanner Container - Always visible when component is shown -->
  <div #scannerContainer [class]="containerClass + '  h-[300px]  border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 relative flex items-center justify-center'">
    <!-- Dynamsoft scanner will be mounted here -->
  </div>

  <!-- Error States -->
  @if (initializationError()) {
    <div class=" mt-4 p-4 border border-red-300 bg-red-50 rounded-lg">
      <div class="flex items-center gap-2 text-red-800 mb-2">
        <i class="pi pi-exclamation-triangle"></i>
        <span class="font-semibold">Error de Inicialización</span>
      </div>
      <p class="text-red-700 text-sm mb-3">{{ initializationError() }}</p>
      <button
        pButton
        type="button"
        label="Reintentar"
        icon="pi pi-refresh"
        class="p-button-sm p-button-outlined p-button-danger"
        (click)="retryInitialization()"
        [loading]="loading()">
      </button>
    </div>
  }

  @if (error() && !initializationError()) {
    <div class="error-container mt-4 p-4 border border-orange-300 bg-orange-50 rounded-lg">
      <div class="flex items-center gap-2 text-orange-800 mb-2">
        <i class="pi pi-exclamation-circle"></i>
        <span class="font-semibold">Error de Escaneo</span>
      </div>
      <p class="text-orange-700 text-sm mb-3">{{ error() }}</p>
      <button
        pButton
        type="button"
        label="Limpiar Error"
        icon="pi pi-times"
        class="p-button-sm p-button-outlined p-button-warning"
        (click)="clearError()">
      </button>
    </div>
  }

  <!-- Upload Image Button (Optional) -->
  @if (showUploadButton && isReady()) {
    <div class="upload-section mt-4">
      <label class="p-button p-button-outlined p-button-info cursor-pointer inline-flex items-center gap-2">
        <i class="pi pi-upload"></i>
        <span>Subir Imagen</span>
        <input
          type="file"
          accept="image/*"
          class="hidden"
          (change)="onFileUpload($event)">
      </label>
    </div>
  }

  <!-- Status Information -->
  @if (lastScannedCode()) {
    <div class="result-info mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="flex items-center gap-2 text-blue-800 mb-2">
        <i class="pi pi-qrcode"></i>
        <span class="text-sm font-medium">Último código escaneado:</span>
      </div>
      <code class="text-blue-900 bg-blue-100 px-2 py-1 rounded text-sm">{{ lastScannedCode() }}</code>
    </div>
  }
</div>
